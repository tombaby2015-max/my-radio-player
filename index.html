<!-- Вставьте этот код вместо текущего заголовка и статусов -->
<div class="header-fixed">
  <div class="header-top">
    <h1>My Radio <span class="version">v1.0</span></h1>
  </div>
  <div class="status-bar">
    <span id="syncStatus">синхронизировано</span>
    <span class="separator">/</span>
    <span id="playStatus">остановлено</span>
  </div>
</div>

<style>
  /* Добавьте эти стили в существующий CSS */
  .header-fixed {
    position: sticky;
    top: 0;
    background: #111;
    z-index: 50;
    padding: 10px 0 5px;
    border-bottom: 1px solid #222;
  }
  
  .header-top {
    text-align: center;
  }
  
  h1 {
    text-align: center;
    font-size: 20px;
    margin: 0 0 5px 0;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
    font-weight: 300;
    color: #fff;
  }
  
  .version {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    font-size: 14px;
    color: #666;
    margin-left: 5px;
  }
  
  .status-bar {
    text-align: center;
    font-size: 12px;
    color: #666;
    margin-bottom: 10px;
  }
  
  .separator {
    margin: 0 8px;
    color: #444;
  }
  
  /* Обновите существующий grid для скроллинга */
  .grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 16px;
    padding: 12px;
    max-width: 320px;
    margin: 0 auto;
    min-height: calc(100vh - 120px); /* Чтобы был скроллинг */
  }
</style>

<script>
  // Обновите функцию playStation для нового статуса
  function playStation(url, name, cardElement) {
    // Если кликаем на уже активную станцию - останавливаем
    if (currentActiveCard === cardElement) {
      stopRadio();
      return;
    }
    
    // Останавливаем предыдущую станцию
    stopRadio();
    
    // Устанавливаем новую активную станцию
    currentActiveCard = cardElement;
    currentStationUrl = url;
    
    // Добавляем класс active для красной рамки
    cardElement.classList.add('active');
    
    // Обновляем статус воспроизведения
    updatePlayStatus("буферизация...");
    
    // Универсальный способ воспроизведения для всех браузеров
    player.innerHTML = '<source src="'+url+'" type="application/vnd.apple.mpegurl">';
    player.load();
    
    var playPromise = player.play();
    
    if (playPromise !== undefined) {
      playPromise.then(function() {
        updatePlayStatus("играет: " + name);
      }).catch(function(error) {
        console.error("Ошибка воспроизведения:", error);
        // Пробуем альтернативный формат для Android/Windows
        tryAlternativePlayback(url, name, cardElement);
      });
    }
  }

  // Альтернативный способ воспроизведения для Android/Windows
  function tryAlternativePlayback(url, name, cardElement) {
    updatePlayStatus("попытка воспроизведения...");
    
    // Создаем новый audio элемент для широкой совместимости
    var audio = new Audio();
    audio.crossOrigin = "anonymous";
    audio.preload = "none";
    
    // Пробуем разные типы MIME
    const audioTypes = [
      'audio/mpegurl',
      'application/vnd.apple.mpegurl', 
      'audio/x-mpegurl',
      'audio/mpeg',
      'audio/aac'
    ];
    
    let sourceAdded = false;
    audioTypes.forEach(type => {
      try {
        const source = document.createElement('source');
        source.src = url;
        source.type = type;
        audio.appendChild(source);
        sourceAdded = true;
      } catch(e) {}
    });
    
    if (!sourceAdded) {
      audio.src = url;
    }
    
    var altPlayPromise = audio.play();
    
    if (altPlayPromise !== undefined) {
      altPlayPromise.then(function() {
        // Если альтернативный способ сработал, заменяем основной плеер
        player = audio;
        updatePlayStatus("играет: " + name);
      }).catch(function(error) {
        console.error("Альтернативное воспроизведение тоже не удалось:", error);
        updatePlayStatus("ошибка воспроизведения");
        cardElement.classList.remove('active');
        currentActiveCard = null;
        currentStationUrl = null;
      });
    }
  }

  // Функция обновления статуса воспроизведения
  function updatePlayStatus(text) {
    document.getElementById('playStatus').textContent = text;
  }

  function stopRadio() {
    try { 
      player.pause(); 
    } catch(e) {}
    
    // Убираем активный класс с текущей карточки
    if (currentActiveCard) {
      currentActiveCard.classList.remove('active');
      currentActiveCard = null;
      currentStationUrl = null;
    }
    
    updatePlayStatus("остановлено");
  }

  // Обновите обработчики событий
  player.addEventListener('waiting', function(){ 
    updatePlayStatus("буферизация..."); 
  });
  
  player.addEventListener('error', function(){ 
    updatePlayStatus("ошибка воспроизведения"); 
    if (currentActiveCard) {
      currentActiveCard.classList.remove('active');
      currentActiveCard = null;
      currentStationUrl = null;
    }
  });
</script>
